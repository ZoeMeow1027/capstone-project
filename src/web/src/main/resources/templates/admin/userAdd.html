<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" th:href="@{/css/admin-page.css}">
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.7/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.0/dist/jquery.min.js"></script>
    <script th:src="@{/js/admin-user-add.js}"></script>
    <title th:text="${action == 'add' ? 'Add' : 'Edit'} + ' - Users - Phone Store Manager [Administrator]'"></title>
</head>
<body>
    <div lang="en" th:replace="~{/fragments/sidenavbar :: sidenavbar(tab='users', user=${name})}"></div>
    <div id="admin-page-data" class="col-sm p-3 min-vh-100" th:with="condition=${action}">
        <a href="/admin/users"><i class="bi bi-arrow-left-circle" style="font-size: 2rem;"></i></a>
        <div th:if="${condition == 'add'}">
            <h2>Add user</h2>
            <h4>Add a user</h4>        
        </div>
        <div th:unless="${condition == 'add'}">
            <h2>Edit user</h2>
            <h4>Edit a user information</h4>
        </div>
        <hr />
        <div class="modal-body" id="dialog-addnew">
            <div id="dialog-addnew-errline" class="text-left text-white bg-danger mb-3 p-2 rounded-1" style="visibility: hidden;"></div>
            <div th:unless="${condition == 'add'}" class="form-floating mb-3">
                <input type="text" id="dialog-addnew-tbid" name="id" class="form-control" readonly th:value="${user == null ? '' : !user.get('id').isJsonNull() ? user.get('id').getAsInt() : ''}">
                <label for="floatingInput">ID</label>
            </div>
            <div class="form-floating mb-3">
                <input type="text" id="dialog-addnew-tbname" name="name" class="form-control" th:value="${user == null ? '' : !user.get('name').isJsonNull() ? user.get('name').getAsString() : ''}">
                <label for="floatingInput">Name</label>
            </div>
            <div class="form-floating mb-3">
                <input type="email" id="dialog-addnew-tbemail" name="email" class="form-control" th:value="${user == null ? '' : !user.get('email').isJsonNull() ? user.get('email').getAsString() : ''}">
                <label for="floatingInput">Email address</label>
            </div>
            <div class="form-floating mb-3">
                <input type="tel" id="dialog-addnew-tbphone" name="phone" class="form-control" th:value="${user == null ? '' : !user.get('phone').isJsonNull() ? user.get('phone').getAsString() : ''}">
                <label for="floatingInput">Phone</label>
            </div>
            <div class="form-floating mb-3">
                <input type="text" id="dialog-addnew-tbusername" name="username"  class="form-control" th:value="${user == null ? '' : !user.get('username').isJsonNull() ? user.get('username').getAsString() : ''}">
                <label for="floatingInput">Username</label>
            </div>
            <div class="form-floating mb-3">
                <select class="form-control form-select" id="dialog-addnew-usertype" name="usertype" aria-label="Floating label select example">
                    <option value="0" th:selected="${user == null ? false : user.get('usertype').isJsonNull() ? false : user.get('usertype').getAsInt() == 0}">User</option>
                    <option value="1" th:selected="${user == null ? false : user.get('usertype').isJsonNull() ? false : user.get('usertype').getAsInt() == 1}">Staff</option>
                    <option value="2" th:selected="${user == null ? false : user.get('usertype').isJsonNull() ? false : user.get('usertype').getAsInt() == 2}">Administrator</option>
                </select>
                <label for="floatingInput">User type</label>
            </div>
            <div th:if="${condition == 'add'}" class="form-floating mb-3">
                <input type="password" id="dialog-addnew-tbpassword" name="password" class="form-control">
                <label for="floatingInput">Password</label>
            </div>
            <div th:if="${condition == 'add'}" class="form-floating mb-3">
                <input type="password" id="dialog-addnew-tbrepassword" class="form-control">
                <label for="floatingInput">Re-enter Password</label>
            </div>
            <button id="dialog-addnew-btnadd" type="button" th:if="${condition == 'add'}" onclick="addNewUser()" class="btn btn-primary me-1 px-4 py-2">Add</button>
            <button id="dialog-addnew-btnupdate" type="button" th:unless="${condition == 'add'}" onclick="updateUser()" class="btn btn-primary me-1 px-4 py-2">Save Changes</button>
            <a th:unless="${condition == 'add'}" th:href="${'/admin/users/resetpassword?id=' + user.get('id').getAsInt()}"><button id="dialog-addnew-btnchangepass" type="button" th:unless="${condition == 'add'}" class="btn btn-primary mx-1 px-4 py-2">Reset Password</button></a>
            <a href="/admin/users"><button id="dialog-addnew-btncancel" type="button" class="btn btn-danger mx-1 px-4 py-2" data-bs-dismiss="modal">Cancel</button></a>
        </div>
    </div>
</body>
</html>